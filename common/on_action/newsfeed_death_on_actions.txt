on_death = {
    on_actions = {
        newsfeed_on_death
        newsfeed_on_death_transfer_message_containers
        newsfeed_on_death_transfer_setting_containers
    }
}

newsfeed_on_death = {
    effect = {
        every_player = {
            limit = {
                NOT = {
                    newsfeed_vanilla_will_show_death = { PERSON = root }
                }
            }

            if = {
                limit = {
                    newsfeed_is_interested_in_death = { PERSON = root }
                }

                newsfeed_notify_of_death_effect = yes
            }
            else = {
                newsfeed_check_relative_of_deceased_effect = { type = parent }
                newsfeed_check_relative_of_deceased_effect = { type = spouse }
                newsfeed_check_relative_of_deceased_effect = { type = child }
                newsfeed_check_relative_of_deceased_effect = { type = sibling }
            }
        }
    }
}

newsfeed_on_death_transfer_message_containers = {
    trigger = {
        is_ai = no
    }

    effect = {
        player_heir = {
            set_variable = {
                name = newsfeed_next_message_index
                value = prev.var:newsfeed_next_message_index
            }
        }

        every_in_list = {
            variable = newsfeed_message_containers

            prev.player_heir = {
                add_to_variable_list = {
                    name = newsfeed_message_containers
                    target = prev
                }
            }
        }
        
        remove_variable = newsfeed_next_message_index
        clear_variable_list = newsfeed_message_containers
    }
}

newsfeed_on_death_transfer_setting_containers = {
    trigger = {
        is_ai = no
    }

    effect = {
        every_in_list = {
            variable = newsfeed_setting_containers

            prev.player_heir = {
                add_to_variable_list = {
                    name = newsfeed_setting_containers
                    target = prev
                }
            }
        }

        clear_variable_list = newsfeed_setting_containers
    }
}